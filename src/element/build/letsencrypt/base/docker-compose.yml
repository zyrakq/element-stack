services:
  element:
    image: vectorim/element-web:latest
    container_name: element
    restart: unless-stopped
    environment:
      TZ: ${MATRIX_TZ}
      SYNAPSE_SERVER_NAME: ${SYNAPSE_SERVER_NAME}
      VIRTUAL_PORT: ${VIRTUAL_PORT:-80}
      VIRTUAL_HOST: ${VIRTUAL_HOST}
      LETSENCRYPT_HOST: ${LETSENCRYPT_HOST}
      LETSENCRYPT_EMAIL: ${LETSENCRYPT_EMAIL}
    configs:
      - source: element-config
        target: /app/config.json
    networks:
      - letsencrypt-network
configs:
  element-config:
    content: |-
      {
        "default_server_name": "${MATRIX_DOMAIN}",
        "default_server_config": {
          "m.homeserver": {
            "base_url": "https://${MATRIX_DOMAIN}"
          }
        },
        "brand": "Element",
        "integrations_ui_url": "https://scalar.vector.im/",
        "integrations_rest_url": "https://scalar.vector.im/api",
        "integrations_widgets_urls": [
          "https://scalar.vector.im/_matrix/integrations/v1",
          "https://scalar.vector.im/api",
          "https://scalar-staging.vector.im/_matrix/integrations/v1",
          "https://scalar-staging.vector.im/api",
          "https://scalar-staging.riot.im/scalar/api"
        ],
        "uisi_autorageshake_app": "element-auto-uisi",
        "show_labs_settings": true,
        "room_directory": {
          "servers": [
            "${MATRIX_DOMAIN}"
          ]
        },
        "enable_presence_by_hs_url": {
          "https://matrix.org": false,
          "https://matrix-client.matrix.org": false
        },
        "features": {
          "threadsActivityCentre": true,
          "feature_video_rooms": true,
          "feature_group_calls": true,
          "feature_element_call_video_rooms": true
        },
        "setting_defaults": {
          "RustCrypto.staged_rollout_percent": 100,
          "Registration.mobileRegistrationHelper": true
        },
        "element_call": {
          "url": "https://call.element.dev"
        },
        "map_style_url": "https://api.maptiler.com/maps/streets/style.json?key=fU3vlMsMn4Jb6dnEIFsx"
      }
networks:
  letsencrypt-network:
    external: true
